(()=>{"use strict";var e={n:t=>{var s=t&&t.__esModule?()=>t.default:()=>t;return e.d(s,{a:s}),s},d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};class t{constructor(e){this.preferences={},this.name=e,this.uuid=crypto.randomUUID()}addPreferences(e,t){this.preferences[e.uuid]=t}loveRatio(e){let t=this.uuid in e.preferences?e.preferences[this.uuid]:0,s=e.uuid in this.preferences?this.preferences[e.uuid]:0;return n=t,(i=s)<-.3||n<-.3?Math.min(i,n):(t+s)/2;var i,n}checkCompatibility(e){let t=0;for(const s of e.kids)t+=this.loveRatio(s);return t}}function s(e,t){let s=!1;for(let i of t)if(i.kids.length==e.kids.length&&(s=e.kids.every((e=>i.kids.includes(e)))&&i.kids.every((t=>e.kids.includes(t))),1==s))return!0;return s}class i{constructor(){this.kids=[],this.bunkList=[]}addCampers(e,t){let s;t.kids&&(s=t.kids.map((e=>e.uuid))),e.forEach((e=>{!1===this.kids.map((e=>e.uuid)).includes(e.uuid)&&!1===s.includes(e.uuid)&&(this.kids.push(e),this.bunkList.push(e.name))}))}calculateScore(){let e=0;for(const[t,s]of this.kids.entries())for(let i=t+1;i<this.kids.length;i++)e+=s.loveRatio(this.kids[i]);return e}}class n{constructor(e,t){this.num=e,this.tzrifim=t,this.id=e,this.bunks=t}score(){let e=0;for(const t of this.bunks)e+=t.calculateScore();return e}}class r{constructor(e,t,s){this.firstKid=e,this.otherKid=t,this.weight=s,this.firstKid=e,this.otherKid=t,this.weight=s}}class a{constructor(e){this.kanikim_by_ids={},this.kanikim=e,this.eidahSize=e.length,this.kanikim.forEach((e=>{this.kanikim_by_ids[e.uuid]=e})),this.reqs=this.constructReqsFromCamperPreferences()}constructReqsFromCamperPreferences(){let e=[],t={};for(const e of this.kanikim){let s=e.uuid;t[s]={};for(const i of Object.keys(e.preferences))i in t!=0&&s in t[i]!=0||(t[s][i]=e.loveRatio(this.kanikim_by_ids[i]))}for(const[s,i]of Object.entries(t))for(const[t,n]of Object.entries(i)){let i=this.kanikim_by_ids[s],a=this.kanikim_by_ids[t],l=new r(i,a,n);e.push(l)}return e}makeBunks(){this.reqs.length;let e=[];for(let s=0;s<1e4;s++){let r=[...this.reqs],a=new i,l=new i,d=t(r,this.kanikim_by_ids,[a,l],void 0),o=d.bunks;if(d.looseChanichim)for(const[e,t]of Object.entries(d.looseChanichim))for(let e=0;e<2;e++){let e,s;if(Boolean(2*o[0].bunkList.length>=this.eidahSize||2*o[1].bunkList.length>=this.eidahSize))o.sort(((e,t)=>e.bunkList.length-t.bunkList.length)),e=o[0],s=o[1];else{let t=Math.round(Math.random());e=o[t],s=o[1-t]}e.addCampers([t],s)}let c=new n(s,o);e.push(c)}function t(e,s,i,n){n||(n=Object.assign({},s));let a=Math.floor(Math.random()*e.length),l=e.splice(a,1)[0],d=((e,t)=>{let i=r(e,t[0])-r(e,t[1]);return Math.abs(i)<1?t[0].kids.length<t[1].kids.length?0:1:i>0&&t[0].kids.length<=Math.ceil(Object.keys(s).length/2)?0:1})(l,i);return i[d].addCampers([l.firstKid,l.otherKid],i[1-d]),delete n[l.firstKid.uuid],delete n[l.otherKid.uuid],e.length>0?t(e,s,i,n):{bunks:i,looseChanichim:n}}function r(e,t){return t.kids&&t.kids.some((t=>t===e.firstKid))?e.otherKid.checkCompatibility(t):t.kids&&t.kids.some((t=>t===e.otherKid))?e.firstKid.checkCompatibility(t):e.firstKid.checkCompatibility(t)+e.otherKid.checkCompatibility(t)}e.sort(((e,t)=>{let s=e.score();return t.score()-s}));let a=[],l=[],d=0,o=0;for(;o<15&&e[d];){let t=e[d],i=t.bunks[0].bunkList.length,n=t.bunks[1].bunkList.length;s(t.bunks[0],l)||1.25*i<n||1.25*n<i?d++:(a.push(t),l.push(t.bunks[0]),l.push(t.bunks[1]),d++,o++)}return a}}const l=$;var d=e.n(l);class o{constructor(){this.text=""}handleFile(e){return new Promise(((t,s)=>{const i=e,n=new FileReader;n.addEventListener("load",(()=>{"string"==typeof n.result&&t(n.result)}),!1),n.addEventListener("error",(()=>{}),!1),i&&n.readAsText(i)}))}}class c{constructor(e,s){this.eidot=[],this.campers=e.map((e=>new t(e)));for(const[e,t]of s.entries())t.forEach((t=>{this.campers[e].addPreferences(this.campers[t[0]],t[1])}))}makeDisplayEidot(){let e=new a(this.campers);this.eidot=e.makeBunks(),console.log(this.eidot);let t=document.querySelector("#results");t.innerHTML="";for(const e of this.eidot){let s=`\n            <div class="suggestion">\n              <span class="score"><b>Score: ${e.score()}</b></span>\n                <table class="results-table" border="1">\n                 <tr>\n                  <td>\n                    <table border="0">\n                        <tr>\n                            <td><b>Bunk א</b></td>\n                            <td><b>Bunk ב</b></td>\n                        </tr>`,i=Math.max(e.bunks[0].bunkList.length,e.bunks[1].bunkList.length);for(let t=0;t<i;t++)s+=`<tr>\n                    <td>${e.bunks[0].bunkList[t]||""}</td>\n                    <td>${e.bunks[1].bunkList[t]||""}</td>\n                </tr>`;s+="            \n                    </table>\n                </td>\n              </tr>\n            </table>\n            </div>",t&&(t.innerHTML+=s)}}}d()(document).ready((()=>{d()("#input_file").change((e=>{let t=[],s=e.target.files[0];(new o).handleFile(s).then((e=>{t=function(e){let t={};return e.forEach((function(s,i){if(e.indexOf(s)!==i){for(var n=((t[s]=s in t?t[s]+1:1)+1),r=s+"("+n+")";-1!==e.indexOf(r);)r=s+"("+ ++n+")";e[i]=r}})),e}(e.split("\n")),t.pop();let s="";d()("#reqs-and-weights").css("display","flex");for(let e=0;e<t.length;e++)d()("#camper-tbody").append(`\n                    <tr class="requests">\n                        <th class="name">\n                            ${t[e]}\n                        </th>\n                        <td>\n                            <select multiple data-placeholder="Select campers..." data-name="${t[e]}" class="chosen-select must" tabindex="5"></select>\n                        </td>\n                        <td>\n                            <select multiple data-placeholder="Select campers..." data-name="${t[e]}" class="chosen-select wants" tabindex="5"></select>\n                        </td>\n                        <td>\n                            <select multiple data-placeholder="Select campers..." data-name="${t[e]}" class="chosen-select prefersNot" tabindex="5"></select>\n                        </td>\n                        <td>\n                            <select multiple data-placeholder="Select campers..." data-name="${t[e]}" class="chosen-select cannot" tabindex="5"></select>\n                        </td>\n                    </tr>`),s+=`<option value="${e}">${t[e]}</option>`;d()(".must, .wants, .prefersNot, .cannot").each(((e,t)=>{d()(t).html(s),d()(t).chosen()})),d()("#generate").click((()=>{let e=[];const s=d()("#A").slider("option","value"),i=d()("#B").slider("option","value"),n=d()("#D").slider("option","value"),r=d()("#F").slider("option","value");d()(".requests").each(((t,a)=>{let l=[],o=d()(a).find("select");o.eq(0).val().forEach((e=>{e.length>0&&l.push([Number(e),s])})),o.eq(1).val().forEach((e=>{e.length>0&&l.push([Number(e),i])})),o.eq(2).val().forEach((e=>{e.length>0&&l.push([Number(e),n])})),o.eq(3).val().forEach((e=>{e.length>0&&l.push([Number(e),r])})),l.length>0&&e.push(l)})),console.log(t,e),new c(t,e).makeDisplayEidot()}))}))})),d()("#A").slider({range:"min",min:0,max:10,value:10,create:(e,t)=>{d()(".A-wrapper").find(".ui-slider-handle").append("<span class='value'></span>"),d()(".A-wrapper").find(".value").html("10")},slide:(e,t)=>{d()(".A-wrapper").find(".value").html(t.value)}}),d()("#B").slider({range:"min",min:0,max:10,value:4,create:(e,t)=>{d()(".B-wrapper").find(".ui-slider-handle").append("<span class='value'></span>"),d()(".B-wrapper").find(".value").html("4")},slide:(e,t)=>{d()(".B-wrapper").find(".value").html(t.value)}}),d()("#D").slider({range:"min",min:-10,max:0,value:-3,create:(e,t)=>{d()(".D-wrapper").find(".ui-slider-handle").append("<span class='value'></span>"),d()(".D-wrapper").find(".value").html("-3")},slide:(e,t)=>{d()(".D-wrapper").find(".value").html(t.value)}}),d()("#F").slider({range:"min",min:-10,max:0,value:-10,create:(e,t)=>{d()(".F-wrapper").find(".ui-slider-handle").append("<span class='value'></span>"),d()(".F-wrapper").find(".value").html("-10")},slide:(e,t)=>{d()(".F-wrapper").find(".value").html(t.value)}})}))})();